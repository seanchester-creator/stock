<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Stock Inventory</title>
  <style>
    :root {
      --bg:#000;
      --text:#fff;
      --panel:#111;
      --border:#444;
      --btn-bg:#fff;
      --btn-text:#000;
      --font: monospace;
    }
    body[data-theme="light"] {
      --bg:#fff;
      --text:#000;
      --panel:#f9f9f9;
      --border:#ccc;
      --btn-bg:#000;
      --btn-text:#fff;
    }
    body[data-font="verdana"] { --font: Verdana, sans-serif; }
    *{box-sizing:border-box}
    body {
      margin:0; font:16px var(--font);
      background:var(--bg); color:var(--text);
    }
    header {
      display:flex; justify-content:space-between; align-items:center;
      padding:10px; border-bottom:1px solid var(--border);
      background:var(--panel);
    }
    header h1 { margin:0; font-size:18px }
    .options { display:flex; gap:10px; }
    select,button,input {
      font:inherit; padding:6px 10px;
      border:1px solid var(--border); border-radius:4px;
      background:var(--btn-bg); color:var(--btn-text);
    }
    button { cursor:pointer }
    .wrap { max-width:800px; margin:auto; padding:10px; }
    .card { border:1px solid var(--border); padding:10px; margin-bottom:10px; background:var(--panel); }
    label { display:block; margin:6px 0 2px; }
    input,select { width:100%; background:var(--bg); color:var(--text); }
    .list { display:grid; gap:8px; }
    .item { border:1px solid var(--border); padding:8px; }
    .sizes { display:flex; flex-wrap:wrap; gap:6px; margin-top:6px; }
    .size { border:1px solid var(--border); padding:4px 6px; }
    .chips { display:flex; flex-wrap:wrap; gap:6px; margin-top:6px; }
    .chip { border:1px solid var(--border); padding:4px 6px; display:flex; gap:6px; align-items:center; }
    .chip button { padding:2px 6px; }
    .controls { margin-top:6px; display:flex; gap:6px; }
  </style>
</head>
<body data-theme="dark" data-font="monospace">
<header>
  <h1>Stock Inventory</h1>
  <div class="options">
    <select id="themeSelect">
      <option value="dark">Dark</option>
      <option value="light">Light</option>
    </select>
    <select id="fontSelect">
      <option value="monospace">Monospace</option>
      <option value="verdana">Verdana</option>
    </select>
  </div>
</header>
<main class="wrap">
  <section class="card">
    <div class="list" id="list"></div>
    <div id="empty">No items yet.</div>
  </section>
  <section class="card" id="passwordSection">
    <h2>Admin Access</h2>
    <input type="password" id="passwordInput" placeholder="Password">
    <button id="unlockBtn">Unlock</button>
  </section>
  <section class="card" id="editorSection" style="display:none">
    <h2>Add / Edit Item</h2>
    <label>Select Item</label>
    <select id="itemSelect"><option value="">-- New Item --</option></select>
    <label>Brand</label><input id="brandInput">
    <label>Colour</label><input id="colorInput">
    <label>Style</label>
    <select id="styleSelect">
      <option>softstyle</option><option>cotton</option>
      <option>heavy cotton</option><option>ultra heavy</option>
      <option>mid softstyle</option><option value="other">Other</option>
    </select>
    <input id="customStyleInput" placeholder="Custom style" style="display:none;margin-top:6px">
    <label>Sizes & Stock</label>
    <div class="chips" id="sizesChips"></div>
    <div id="measurementsSection" style="display:none">
      <h3>Measurements</h3>
      <div id="measurementInputs"></div>
    </div>
    <button id="saveItemBtn">Save</button>
    <button id="deleteBtn">Delete</button>
  </section>
</main>
<template id="itemTmpl">
  <div class="item">
    <div><span class="color"></span> – <strong class="brand"></strong> <span class="note"></span></div>
    <div class="sizes"></div>
  </div>
</template>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig={apiKey:"AIzaSyCklSHKdm_sB83BsrDKuMzXddGgFi26w5w",
authDomain:"stock-2d5a3.firebaseapp.com",projectId:"stock-2d5a3",
storageBucket:"stock-2d5a3.firebasestorage.app",messagingSenderId:"419253323633",
appId:"1:419253323633:web:d6e4adca4d2464f320d8d0"};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();
const sizesDefault=["S","M","L","XL","2XL","3XL","4XL"];
const el=id=>document.getElementById(id);
let currentId=null,sizeMap={},measurements={},cachedItems=[],isAdmin=false;

// THEME + FONT
el("themeSelect").onchange=()=>{document.body.setAttribute("data-theme",el("themeSelect").value);localStorage.setItem("theme",el("themeSelect").value)};
el("fontSelect").onchange=()=>{document.body.setAttribute("data-font",el("fontSelect").value);localStorage.setItem("font",el("fontSelect").value)};
if(localStorage.getItem("theme")){document.body.setAttribute("data-theme",localStorage.getItem("theme"));el("themeSelect").value=localStorage.getItem("theme");}
if(localStorage.getItem("font")){document.body.setAttribute("data-font",localStorage.getItem("font"));el("fontSelect").value=localStorage.getItem("font");}

// ADMIN
el("unlockBtn").onclick=()=>{if(el("passwordInput").value==="sonny"){isAdmin=true;el("editorSection").style.display="block";el("passwordSection").style.display="none";resetEditor();render()}else alert("Wrong password")};
el("styleSelect").onchange=()=>{el("customStyleInput").style.display=el("styleSelect").value==="other"?"block":"none"};

function initSizeChips(initial={}){el("sizesChips").innerHTML="";sizeMap={};sizesDefault.forEach(s=>{sizeMap[s]=initial[s]||0;const d=document.createElement("div");d.className="chip";d.innerHTML=`<strong>${s}</strong><button data-delta=-1>−</button><span class=qty>${sizeMap[s]}</span><button data-delta=1>+</button>`;d.onclick=e=>{if(e.target.dataset.delta){sizeMap[s]=Math.max(0,sizeMap[s]+ +e.target.dataset.delta);d.querySelector(".qty").textContent=sizeMap[s];}};el("sizesChips").appendChild(d)});updateMeasurementsInputs(initial.measurements)};
function updateMeasurementsInputs(initial={}){el("measurementInputs").innerHTML="";sizesDefault.forEach(s=>{const i=document.createElement("input");i.placeholder=s+" measurement";i.value=initial[s]||"";i.oninput=()=>{measurements[s]=i.value};el("measurementInputs").appendChild(i)});el("measurementsSection").style.display="block"};

async function loadItems(){const snap=await db.collection("inventory").orderBy("order","asc").get().catch(()=>db.collection("inventory").get());const items=snap.docs.map(doc=>({...doc.data(),id:doc.id}));items.sort((a,b)=>(a.order??0)-(b.order??0));cachedItems=items;return items};
async function saveItem(item){if(!item.order) item.order=Date.now();if(item.id){await db.collection("inventory").doc(item.id).set(item)}else{const ref=await db.collection("inventory").add(item);item.id=ref.id}};
async function deleteItem(id){await db.collection("inventory").doc(id).delete()};

async function render(){const items=await loadItems();el("list").innerHTML="";if(!items.length){el("empty").style.display="block"}else el("empty").style.display="none";el("itemSelect").innerHTML="<option value=''>-- New Item --</option>";items.forEach(it=>{el("itemSelect").innerHTML+=`<option value='${it.id}'>${it.color} – ${it.brand} (${it.style||''})</option>`;el("list").appendChild(renderItem(it))})};
function renderItem(it){let n=el("itemTmpl").content.firstElementChild.cloneNode(true);n.dataset.id=it.id;n.querySelector(".brand").textContent=it.brand;n.querySelector(".color").textContent=it.color;n.querySelector(".note").textContent=it.style?`(${it.style})`:'';let s=n.querySelector(".sizes");Object.entries(it.sizes||{}).forEach(([k,v])=>{let d=document.createElement("div");d.className="size";d.textContent=`${k}: ${v}`;s.appendChild(d)});if(it.measurements){let m=document.createElement("div");m.textContent="Measurements: "+Object.entries(it.measurements).map(([k,v])=>`${k}: ${v}`).join(", ");n.appendChild(m)}return n};
async function startEdit(id){const doc=await db.collection("inventory").doc(id).get();if(!doc.exists)return;const it=doc.data();it.id=doc.id;currentId=it.id;el("brandInput").value=it.brand||"";el("colorInput").value=it.color||"";el("styleSelect").value=["softstyle","cotton","heavy cotton","ultra heavy","mid softstyle"].includes(it.style)?it.style:"other";if(el("styleSelect").value==="other"){el("customStyleInput").style.display="block";el("customStyleInput").value=it.style}else el("customStyleInput").style.display="none";measurements={...it.measurements};initSizeChips(it.sizes||{});updateMeasurementsInputs(it.measurements||{});el("itemSelect").value=it.id};
el("itemSelect").onchange=()=>{el("itemSelect").value?startEdit(el("itemSelect").value):resetEditor()};
el("saveItemBtn").onclick=async()=>{let b=el("brandInput").value.trim(),c=el("colorInput").value.trim();if(!b||!c)return alert("Need brand & colour");let st=el("styleSelect").value;if(st==="other") st=el("customStyleInput").value.trim()||"Other";let obj={id:currentId,brand:b,color:c,style:st,sizes:{...sizeMap},measurements:{...measurements}};const existing=cachedItems.find(x=>x.id===currentId);if(existing&&existing.order)obj.order=existing.order;await saveItem(obj);resetEditor();render()};
el("deleteBtn").onclick=async()=>{if(currentId&&confirm("Delete?")){await deleteItem(currentId);resetEditor();render()}};
function resetEditor(){currentId=null;el("brandInput").value=el("colorInput").value=el("customStyleInput").value="";el("styleSelect").value="softstyle";el("customStyleInput").style.display="none";measurements={};initSizeChips();el("itemSelect").value=""};
render();
</script>
</body>
</html>